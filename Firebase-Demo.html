<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Jee Son Hee - Firebase Add Only</title>
  <style>
    .button
    {
     padding: 7px;
     margin: 5px;
     background-color: skyblue;
     border: 2px dotted;
    border-radius: 3px;
    }
  </style>
</head>
<body>
  <h1>STUDENT RECORD</h1>
  <section>
    <form id="recordForm" onsubmit="return false;">
      <label>ID:</label>
      <input type="text" id="idInput" placeholder="Enter ID"><br><br>
      <label>Name:<br />
        <input type="text" id="nameInput" required />
      </label><br/>
      <label>Age:<br />
        <input type="number" id="ageInput" min="0" />
      </label><br/>
      <label>Course:<br />
        <input type="text" id="courseInput" />
      </label><br/>
<br><button class="button" type="button" onclick="saveRecord()">Save</button>
     <button class="button" type="button" onclick="clearForm()">Clear</button>
    </form>
  </section>
  <h2>Search Student</h2>
<input type="text" id="searchinput" placeholder="Search by Name or Course" onkeyup="searchRecords()">

  <h2>All Students Records</h2>
  <table border="1" collpadding="6" cellspacing="0" id="studentTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Age</th>
        <th>Course</th>
        <th>Actions</th>
    </tr>
  </thead>
  <tbody id="studentTableBody">
    <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
  </tbody>
  </table>
  <h1>SUBJECT RECORD</h1>
<section>
  <form id="subjectForm" onsubmit="return false;">
    <label>Subject Code:</label>
    <input type="text" id="subjectCodeInput" placeholder="Enter Subject Code"><br><br>
    <label>Description:<br />
      <input type="text" id="descriptionInput" required />
    </label><br/>
    <label>Units:<br />
      <input type="number" id="unitsInput" min="0" />
    </label><br/>
    <label>Room:<br />
      <input type="text" id="roomInput" />
    </label><br/>
    <br>
    <button class="button" type="button" onclick="saveSubject()">Save</button>
    <button class="button" type="button" onclick="clearSubjectForm()">Clear</button>
  </form>
</section>

<!--Display only-->
  <h2>Subjects</h2>
  <table border="1" collpadding="6" cellspacing="0" id="subjectTable">
  <thead>
    <tr>
      <th>SCID</th>
      <th>Description</th>
      <th>Units</th>
      <th>Room</th>
      <th>Actions</th>
    </tr>
 </thead>
  <tbody id="subjectTablebody">
   <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
  </tbody>
  </table>


  <div id="status" aria-live="polite" style="margin-top:12px;"></div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
 
    const firebaseConfig = {
      apiKey: "AIzaSyBJYueqdQ1UG2nJbt9Y0j9LJ3Vt2jeLQh4",
      authDomain: "json-crud-mendez.firebaseapp.com",
      projectId: "json-crud-mendez",
      storageBucket: "json-crud-mendez.firebasestorage.app",
      messagingSenderId: "401623403203",
      appId: "1:401623403203:web:69791cdd568623233bf076",
      measurementId: "G-27MMYTDGVD"
    };
 
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
 
    const statusEl = document.getElementById('status');
    const tableBody = document.getElementById('studentTableBody')
    function setStatus(msg, isError = false) {
      statusEl.textContent = msg;
      statusEl.style.color = isError ? 'red' : 'green';
    }
 
    window.editRecord = function(id, student) {
  // Fill form with existing values
  document.getElementById('idInput').value = id;
  document.getElementById('idInput').disabled = true;
  document.getElementById('nameInput').value = student.name;
  document.getElementById('ageInput').value = student.age ?? '';
  document.getElementById('courseInput').value = student.course ?? '';

  setStatus("Editing record: " + id);
};
window.deleteRecord = async function(id) {
  if (!confirm("Delete record " + id + "?")) return;

  try {
    await remove(ref(database, 'students/' + id));
    setStatus("Record deleted: " + id);
  } catch (err) {
    setStatus("Error deleting: " + err.message, true);
  }
};

    window.saveRecord = async function() {
      const id = document.getElementById('idInput').value.trim();
      const name = document.getElementById('nameInput').value.trim();
      const ageVal = document.getElementById('ageInput').value;
      const age = ageVal === "" ? null : Number(ageVal);
      const course = document.getElementById('courseInput').value.trim();
 
      if (!id || !name) {
        setStatus('ID and Name are required.', true);
        return;
      }
 
      const newRecord = { id, name, age, course };
      const studentRef = ref(database, 'students/' + id);
 
      try {
        await set(studentRef, newRecord);
        setStatus('Record saved to Firebase: ' + id);
        document.getElementById('recordForm').reset();
      } catch (err) {
        setStatus('Error saving record: ' + err.message, true);
        alert('Error saving to Firebase: ' + err.message);
      }
    };

    // ===== Function to Load & Display Records =====
    function loadRecords() {
  const studentsRef = ref(database, 'students');

  onValue(studentsRef, (snapshot) => {
    const data = snapshot.val();
    tableBody.innerHTML = '';

    if (!data) {
      tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No records found.</td></tr>';
      return;
    }

    Object.values(data).forEach((student) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${student.id}</td>
        <td>${student.name}</td>
        <td>${student.age ?? ''}</td>
        <td>${student.course ?? ''}</td>
        <td>
          <button class='button' onclick='editRecord("${student.id}", ${JSON.stringify(student)})'>Edit</button>
          <button class='button' onclick='deleteRecord("${student.id}")'>Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  });
}
 window.clearForm = function(){
      document.getElementById('recordForm').reset();
      document.getElementById('idInput').disabled = false;
      setStatus('');
     }

     window.searchRecords = function(){

      const filter = searchinput.value.toLowerCase();
      const rows = tableBody.getElementsByTagName('tr')

      for (let row of rows) {
        const name = row.cells[1]?.textContent.toLowerCase()||'';
        const course = row.cells[3]?.textContent.toLowerCase()||'';
        if(name.includes(filter) || course.includes(filter)){
          row.style.display="";
        }else {
          row.style.display = 'none'
        }
      }
     }

    const subjectTableBody = document.getElementById('subjectTablebody');

// Save Subject
window.saveSubject = async function() {
  const code = document.getElementById('subjectCodeInput').value.trim();
  const description = document.getElementById('descriptionInput').value.trim();
  const unitsVal = document.getElementById('unitsInput').value;
  const units = unitsVal === "" ? null : Number(unitsVal);
  const room = document.getElementById('roomInput').value.trim();

  if (!code || !description) {
    setStatus('Subject Code and Description are required.', true);
    return;
  }

  const newSubject = { code, description, units, room };
  const subjectRef = ref(database, 'subjects/' + code);

  try {
    await set(subjectRef, newSubject);
    setStatus('Subject saved: ' + code);
    document.getElementById('subjectForm').reset();
  } catch (err) {
    setStatus('Error saving subject: ' + err.message, true);
  }
};

// Edit Subject
window.editSubject = function(code, subject) {
  document.getElementById('subjectCodeInput').value = code;
  document.getElementById('subjectCodeInput').disabled = true;
  document.getElementById('descriptionInput').value = subject.description;
  document.getElementById('unitsInput').value = subject.units ?? '';
  document.getElementById('roomInput').value = subject.room ?? '';

  setStatus("Editing subject: " + code);
};

// Delete Subject
window.deleteSubject = async function(code) {
  if (!confirm("Delete subject " + code + "?")) return;

  try {
    await remove(ref(database, 'subjects/' + code));
    setStatus("Subject deleted: " + code);
  } catch (err) {
    setStatus("Error deleting subject: " + err.message, true);
  }
};

// Clear Subject Form
window.clearSubjectForm = function() {
  document.getElementById('subjectForm').reset();
  document.getElementById('subjectCodeInput').disabled = false;
  setStatus('');
};

function loadSubjects() {
  const subjectsRef = ref(database, 'subjects');

  onValue(subjectsRef, (snapshot) => {
    const data = snapshot.val();
    subjectTableBody.innerHTML = '';

    if (!data) {
      subjectTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No subjects found.</td></tr>';
      return;
    }

    Object.entries(data).forEach(([code, subject]) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${code}</td>
        <td>${subject.description}</td>
        <td>${subject.units ?? ''}</td>
        <td>${subject.room ?? ''}</td>
        <td>
          <button class='button' onclick='editSubject("${code}", ${JSON.stringify(subject)})'>Edit</button>
          <button class='button' onclick='deleteSubject("${code}")'>Delete</button>
        </td>
      `;
      subjectTableBody.appendChild(row);
    });
  });
}

    loadRecords();
    loadSubjects();
  </script>
</body>
</html>